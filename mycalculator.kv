# --- استایل‌ها همان قبلی‌ها هستند ---
<RoundedButton@Button>:
    size_hint: 1, 1
    background_color: 0,0,0,0
    background_normal: ''
    font_size: 32
    canvas.before:
        Color:
            rgba: (0.2, 0.2, 0.2, 1) if self.state == 'normal' else (0.3, 0.3, 0.3, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [20,]

<OperatorButton@Button>:
    size_hint: 1, 1
    background_color: 0,0,0,0
    background_normal: ''
    font_size: 40
    canvas.before:
        Color:
            rgba: (1, 0.6, 0, 1) if self.state == 'normal' else (1, 0.7, 0.2, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [20,]

<SciButton@Button>:
    size_hint: 1, 1
    background_color: 0,0,0,0
    background_normal: ''
    font_size: 24  # فونت را کمی کوچک کردیم تا متن‌ها جا بشوند
    canvas.before:
        Color:
            rgba: (0.5, 0.2, 0.7, 1) if self.state == 'normal' else (0.6, 0.3, 0.8, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [15,]

<ActionRoundedButton@RoundedButton>:
    color: 1, 0.3, 0.3, 1

<MainLayout>:
    id: calculator
    display: input
    sci_grid: sci_area
    orientation: 'vertical'
    padding: 15
    spacing: 10

    # 1. نمایشگر
    TextInput:
        id: input
        text_hint:"ASO"
        halign: "right"
        font_size: 85
        multiline: False
        readonly: True
        size_hint_y: 0.25
        background_color: 0,0,0,0
        foreground_color: 1,1,1,1
        cursor_color: 0,0,0,0
        on_text: root.adjust_font_size()

    # 2. نوار ابزار بالا
    GridLayout:
        cols: 4
        spacing: 10
        size_hint_y: 0.15
        
        ActionRoundedButton:
            text: "CLS"
            on_press: input.text = ""
        ActionRoundedButton:
            text: "Eng"
            on_press: calculator.toggle_eng()
        RoundedButton:
            text: "%"
            on_press: input.text += "%"
        OperatorButton:
            text: "÷"
            on_press: input.text += "÷"

    # 3. پنل مهندسی (گسترده شده)
    GridLayout:
        id: sci_area
        cols: 4
        spacing: 10
        size_hint_y: None
        height: 0
        opacity: 0
        
        # ردیف 1: مثلثات پایه
        SciButton:
            text: "sin"
            on_press: input.text += "sin("
        SciButton:
            text: "cos"
            on_press: input.text += "cos("
        SciButton:
            text: "tan"
            on_press: input.text += "tan("
        SciButton:
            text: "cot"
            on_press: input.text += "cot("

        # ردیف 2: معکوس مثلثات
        SciButton:
            text: "asin"
            on_press: input.text += "asin("
        SciButton:
            text: "acos"
            on_press: input.text += "acos("
        SciButton:
            text: "atan"
            on_press: input.text += "atan("
        SciButton:
            text: "acot"
            on_press: input.text += "acot("

        # ردیف 3: سایر توابع
        SciButton:
            text: "log"
            on_press: input.text += "log10("
        SciButton:
            text: "√"
            on_press: input.text += "sqrt("
        SciButton:
            text: "^"
            on_press: input.text += "^"
        SciButton:
            text: "π"
            on_press: input.text += "pi"

        # ردیف 4: پرانتزها
        SciButton:
            text: "("
            on_press: input.text += "("
        SciButton:
            text: ")"
            on_press: input.text += ")"
        # دو فضای خالی برای حفظ تقارن (یا دکمه‌های آینده)
        Widget: 
        Widget:

    # 4. صفحه کلید اعداد
    GridLayout:
        cols: 4
        spacing: 10
        size_hint_y: 0.5  # فضای اعداد کمی کمتر شد تا مهندسی جا شود

        RoundedButton:
            text: "7"
            on_press: input.text += "7"
        RoundedButton:
            text: "8"
            on_press: input.text += "8"
        RoundedButton:
            text: "9"
            on_press: input.text += "9"
        OperatorButton:
            text: "×"
            on_press: input.text += "×"

        RoundedButton:
            text: "4"
            on_press: input.text += "4"
        RoundedButton:
            text: "5"
            on_press: input.text += "5"
        RoundedButton:
            text: "6"
            on_press: input.text += "6"
        OperatorButton:
            text: "-"
            on_press: input.text += "-"

        RoundedButton:
            text: "1"
            on_press: input.text += "1"
        RoundedButton:
            text: "2"
            on_press: input.text += "2"
        RoundedButton:
            text: "3"
            on_press: input.text += "3"
        OperatorButton:
            text: "+"
            on_press: input.text += "+"

        RoundedButton:
            text: "00"
            on_press: input.text += "00"
        RoundedButton:
            text: "0"
            on_press: input.text += "0"
        RoundedButton:
            text: "."
            on_press: input.text += "."
        OperatorButton:
            text: "="
            on_press: calculator.calc(input.text)
